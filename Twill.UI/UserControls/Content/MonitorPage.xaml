<UserControl x:Class="Twill.UI.UserControls.Content.MonitorPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:content="clr-namespace:Twill.UI.Core.Models.Content;assembly=Twill.UI.Core"
             xmlns:converters="clr-namespace:Twill.UI.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:decorators="clr-namespace:Twill.UI.Decorators"
             xmlns:local="clr-namespace:Twill.UI.UserControls.Content"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:timeline="clr-namespace:Twill.UI.UserControls.Controls.TimeLine"
             xmlns:timelinemodels="clr-namespace:Twill.UI.Core.Models.Controls.TimeLine;assembly=Twill.UI.Core"
             d:DataContext="{d:DesignInstance content:MonitorPageModel,
                                              IsDesignTimeCreatable=True}"
             d:DesignHeight="{Binding ElementName=processes}"
             d:DesignWidth="1200"
             mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Twill.UI;component/Styles/Menu.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:ReportsTimeIntervalToHeightConverter x:Key="ReportsTimeIntervalToHeightConverter" />
            <converters:ToListConverter x:Key="ToListConverter" />
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>

        <Grid x:Name="grid" MaxHeight="{Binding ActualHeight, ElementName=processes}">
            <Border BorderBrush="Gray" BorderThickness="0" />
            <ScrollViewer Margin="0" Style="{DynamicResource TwillMenuScrollViewer}">
                <decorators:MouseTrackerDecorator>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="231*" />
                            <ColumnDefinition Width="250*" />
                        </Grid.ColumnDefinitions>

                        <Button x:Name="timeline"
                                Grid.Column="0"
                                Height="{Binding ActualHeight,
                                                 ElementName=processes}"
                                MinWidth="60"
                                Command="{Binding AddNewRecordCommand}"
                                Padding="0"
                                Style="{DynamicResource ButtonWithoutStyle}">
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource ToListConverter}">
                                    <Binding ElementName="processes" Path="ActualHeight" />
                                    <Binding Path="MousePosition.Y" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type decorators:MouseTrackerDecorator}}" />
                                </MultiBinding>
                            </Button.CommandParameter>
                            <timeline:Ruler />
                        </Button>

                        <Border Grid.Column="1"
                                HorizontalAlignment="Left"
                                Background="Black"
                                BorderBrush="Black"
                                BorderThickness="1,0,0,0">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="7"
                                                  ShadowDepth="0"
                                                  Color="Black" />
                            </Border.Effect>
                        </Border>
                        <Border Grid.Column="1"
                                HorizontalAlignment="Left"
                                Background="Black"
                                BorderBrush="Black"
                                BorderThickness="1,0,0,0">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="12"
                                                  ShadowDepth="0"
                                                  Color="Black" />
                            </Border.Effect>
                        </Border>

                        <ListBox x:Name="processes"
                                 Grid.Column="1"
                                 Height="2000"
                                 ItemsSource="{Binding ProcessDayLabors}"
                                 ScrollViewer.VerticalScrollBarVisibility="Hidden"
                                 Style="{DynamicResource TwillMenuListBox}">
                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>

                            <ListBox.ItemTemplate>
                                <ItemContainerTemplate>
                                    <timeline:ProcessDayLabor Width="150"
                                                              Height="{Binding ActualHeight,
                                                                               ElementName=processes,
                                                                               Mode=OneWay}"
                                                              ProcessDayLaborModel="{Binding}" />
                                </ItemContainerTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <ListBox x:Name="reports"
                                 Grid.Column="2"
                                 Height="{Binding ActualHeight,
                                                  ElementName=processes}"
                                 ItemsSource="{Binding Reports}"
                                 ScrollViewer.CanContentScroll="False"
                                 ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                 Style="{DynamicResource TwillMenuListBox}">
                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical" />
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="{x:Type ListBoxItem}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                <ContentPresenter />
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <ItemContainerTemplate>
                                    <Grid Width="{Binding ActualWidth, Mode=OneWay, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}">
                                        <Grid.Height>
                                            <MultiBinding Converter="{StaticResource ReportsTimeIntervalToHeightConverter}">
                                                <Binding />
                                                <Binding ElementName="processes" Path="ActualHeight" />
                                                <Binding Path="End" />
                                            </MultiBinding>
                                        </Grid.Height>
                                        <TextBox AcceptsReturn="True"
                                                 BorderThickness="0,1,0,1"
                                                 Text="{Binding Text,
                                                                Mode=TwoWay,
                                                                UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" />
                                    </Grid>
                                </ItemContainerTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        
                        <Line Grid.Column="1"
                              Grid.ColumnSpan="2"
                              Stroke="Blue"
                              StrokeThickness="1"
                              X1="0"
                              X2="{Binding ActualWidth,
                                           Mode=OneWay,
                                           RelativeSource={RelativeSource FindAncestor,
                                                                          AncestorType={x:Type Grid}}}"
                              Y1="{Binding MousePosition.Y,
                                           RelativeSource={RelativeSource FindAncestor,
                                                                          AncestorType={x:Type decorators:MouseTrackerDecorator}}}"
                              Y2="{Binding MousePosition.Y,
                                           RelativeSource={RelativeSource FindAncestor,
                                                                          AncestorType={x:Type decorators:MouseTrackerDecorator}}}">
                            <Line.Style>
                                <Style TargetType="Line">
                                    <Setter Property="Visibility" Value="Hidden" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMouseOver, ElementName=timeline, Mode=OneWay}" Value="True">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Line.Style>
                        </Line>



                    </Grid>
                </decorators:MouseTrackerDecorator>

            </ScrollViewer>
        </Grid>


        <!--<timeline:ProcessDayLabor Width="150"
                                                           Height="{Binding ActualHeight,
                                                                            ElementName=processes,
                                                                            Mode=OneWay}"
                                                              ProcessDayLaborModel="{Binding ProcessDayLaborModel}"
                                                              />-->

        <!--<timeline:ProcessLabor Width="150"
                                                           Height="{Binding ActualHeight,
                                                                            ElementName=processes,
                                                                            Mode=OneWay}"
                                                           ProcessLaborModel="{Binding ProcessLaborModel}" />-->
    </Grid>
</UserControl>
